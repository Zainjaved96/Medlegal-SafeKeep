<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Med Legal Safe Keep: Your secure health data, shared with utmost safety, when it counts the most. Protecting lives, always.">
  <meta name="author" content="elemis">
  <title>Request Access | Med Legal Safe Keep - A modern way to Safe Keep Your Health</title>
  <link rel="shortcut icon" href="./assets/img/favicon.png">
  <link rel="stylesheet" href="./assets/css/plugins.css">
  <link rel="stylesheet" href="./assets/css/style.css">
  <link rel="stylesheet" href="./assets/css/colors/grape.css">
  <link rel="preload" href="./assets/css/fonts/urbanist.css" as="style" onload="this.rel='stylesheet'">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>

</head>
<style>
    .iti {
    width: 100%;
    position: relative;
    display: inline-block;
}
</style>
<body>
    <!-- Navbar -->
    <header class="wrapper bg-soft-primary ">
        <nav class="navbar navbar-expand-lg center-nav transparent navbar-light">
            <div class="container flex-lg-row flex-nowrap align-items-center">
            <div class="navbar-brand w-100">
                <a href="/">
                <img src="./assets/img/logo-light.png" style="width: 134px; " alt="" />
                </a>
            </div>
            <div class="navbar-collapse offcanvas offcanvas-nav offcanvas-start">
                <div class="offcanvas-header d-lg-none">
                <p class="text-white fs-30 mb-0">Med Legal </p>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body ms-lg-auto d-flex flex-column h-100">
                <ul class="navbar-nav">
                    <li class="nav-item dropdown dropdown-mega">
                    <a class="nav-link" href="/" data-bs-toggle="dropdown-item">Home</a>
                    <!--/.dropdown-menu -->
                    </li>
                    
                    <li class="nav-item dropdown dropdown-mega">
                    <a class="nav-link" href="features.html" data-bs-toggle="dropdown-item">Features</a>
                    <!--/.dropdown-menu -->
                    </li>
<li class="nav-item dropdown dropdown-mega">
                    <a class="nav-link active" href="partners.html" data-bs-toggle="dropdown-item">Partners</a>
                    <!--/.dropdown-menu -->
                    </li>
                    <li class="nav-item dropdown dropdown-mega">
                    <a class="nav-link" href="about.html" data-bs-toggle="dropdown-item">About Us</a>
                    <!--/.dropdown-menu -->
                    </li>
                    <li class="nav-item dropdown dropdown-mega">
                    <a class="nav-link" href="contact.html" data-bs-toggle="dropdown-item">Contact Us</a>
                    <!--/.dropdown-menu -->
                    </li>
    
                    
                
    
                    
            
                </ul>
                <!-- /.navbar-nav -->
                <div class="offcanvas-footer d-lg-none">
                    <div>
                    <a href="mailto:support@Med Legal" class="link-inverse text-decoration-underline">support@Med Legal.com</a>
                        <!-- <br /> +1 215 301-7697 <br /> -->
                    
                    </div>
                </div>
                <!-- /.offcanvas-footer -->
                </div>
                <!-- /.offcanvas-body -->
            </div>
            <!-- /.navbar-collapse -->
            <div class="navbar-other w-100 d-flex ms-auto">
                <ul class="navbar-nav flex-row align-items-center ms-auto">
                <li class="nav-item d-none d-md-block">
                    <a href="https://portal.medlegalsafekeep.com/" class="btn btn-sm btn-primary rounded">Get Started</a>
                </li>
                <li class="nav-item d-lg-none">
                    <button class="hamburger offcanvas-nav-btn" aria-label="hamburger"><span></span></button>
                </li>
                </ul>
                <!-- /.navbar-nav -->
            </div>
            <!-- /.navbar-other -->
            </div>
            <!-- /.container -->
        </nav>
        <!-- /.navbar -->
    </header>

    <section class="wrapper bg-dark text-white">
        <div class="container text-center py-md-12">
          <div class="row">
            <div class="col-sm-10 col-md-8 col-lg-6 col-xl-6 col-xxl-5 mx-auto">
              <h1 class="display-1 text-white mb-3">Request Access</h1>
              <p class="lead ">Your one step away from getting to the information you need.</p>
            </div>
            <!-- /column -->
          </div>
          <!-- /.row -->
        </div>
        <!-- /.container -->
      </section>
      <!-- /section -->
      <section class="wrapper bg-light">
        <div class="container pb-14 pb-md-16">
          <div class="row">
            <div class="col mb-8">
              <div class="card shadow-lg">
                <div class="row mx-auto gx-0">
                  <div class="col-lg-6 mx-auto  image-wrapper bg-image bg-cover rounded-top rounded-lg-start d-none d-md-block" data-image-src="./assets/img/photos/tm1.jpg">
                  </div>
                  <!--/column -->
                  
                </div>
                <!--/.row -->
              </div>
              <!-- /.card -->
            </div>
            <!-- /column -->
          </div>
          <!-- /.row -->
          <div class="row mx-auto " >
            <div class="col-xl-10 mx-auto">
              <div class="row gy-10 mx-auto gx-lg-8 gx-xl-12">
                <div class="col-lg-8 mx-auto" >
                  <form class="contact-form needs-validation" id="request-form">
                    <div class="messages"></div>
                    <div class="row gx-4">
                        <div class="col-md-12">
                            <div class="mb-4">
                                <label for="">Name*</label>
                              <input id="name" type="text" name="name" class="form-control" placeholder="Micah Richards" required>
                              <div class="valid-feedback"> Looks good! </div>
                              <div class="invalid-feedback"> Please enter your last name. </div>
                            </div>
                          </div>
                          <!-- /column -->
                      <div class="col-md-6">
                        <div class="mb-4" id="phone-section"  >
                          <label for="form_name" class=" ">Phone No*</label>
                          <input id="phone" required  type="tel" title="Number must have country code starting with +"   pattern="^\+.*"  class="form-control" placeholder="+1 2016 6012 94" required>
                          <div class="valid-feedback"> Looks good! </div>
                          <div id="phone-error" class="invalid-feedback"> Please enter your first name. </div>
                        </div>
                      </div>
                      <!-- /column -->
                      <div class="col-md-6">
                        <div class="mb-4" id="client-phone-section">
                          <label for="form_name" class=" ">Clients Phone*</label>
                          <input id="client-phone" name="" type="tel" 
                          title="Number must have country code" pattern="^\+.*"  
                           class="form-control" placeholder="+1 2016 6012 94" required>
                          <div class="valid-feedback"> Looks good! </div>
                          <div class="invalid-feedback"> Please enter your first name. </div>
                        </div>
                      </div>
                      <!-- /column -->
                     
                      <div class="col-md-12">
                        <div class="mb-4">
                            <label for="">Occupation*</label>
                          <input id="role" type="text" name="occupation" class="form-control" placeholder="Doctor / Attorney" required>
                          <div class="valid-feedback"> Looks good! </div>
                          <div class="invalid-feedback"> Please enter your last name. </div>
                        </div>
                      </div>
                      <!-- /column -->
                      <div class="col-md-12">
                        <div class="mb-4">
                            <label for="">Why do you want to access the data?</label>
                            <textarea id="purpose"
                             name="reason" 
                            class="form-control" 
                            placeholder="I want to access my clients health history." 
                            style="height: 150px" 
                            ></textarea>
                            <div class="valid-feedback"> Looks good! </div>
                          <div class="invalid-feedback"> Please enter your last name. </div>
                        </div>
                      </div>
                      <!-- /column -->

                      <div class="col-12">
                        <div class="form-check mb-4">
                          <input class="form-check-input" type="checkbox" value="" id="invalidCheck" required>
                          <label class="form-check-label" for="invalidCheck">I agree to <a href="#" class="hover">share my current location</a>. </label>
                          <div class="invalid-feedback"> You must agree before submitting. </div>
                        </div>
                      </div>
                      <!-- /column -->
                      <p id="response_success" class="text-success"></p>
                      <p id="response_error" class="text-danger"></p>
                      <div class="col-12">
                        <button type="submit" class="btn btn-primary rounded-pill btn-send mb-3" >
                          <span>Request Access </span>
                          <div id="loader" class="spinner-border spinner-border-sm d-none m-2" role="status">
                            <span class="visually-hidden">Loading...</span>
                          </div>
                        </button>
                      
                       
                      </div>
                      <!-- /column -->
                    </div>
                    <!-- /.row -->
                  </form>
                  <!-- /form -->
                </div>
                <!--/column -->
               
              </div>
              <!--/.row -->
            </div>
            <!-- /column -->
          </div>
          <!-- /.row -->
        </div>
        <!-- /.container -->
      </section>
</body>
<!-- Phone Number -->
<script>
var input1 = document.querySelector("#phone");
      window.intlTelInput(input1, {
        // options here
        initialCountry: "us",
        utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"
      });
var input2 = document.querySelector("#client-phone");
      window.intlTelInput(input2, {
        // options here
        initialCountry: "us",
        utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"
      });
</script>
<script>

    const write_error = (section, string) => {
        element = section.querySelector(".invalid-feedback")
        element.value = string
        element.scrollIntoView();
    }

    const check_n_parse_phone = (section_id,)=> {
        const section = document.getElementById(section_id)
        let val = section.querySelector('.form-control').value
        const country_code = "+" +  section.querySelector('.iti__selected-flag').getAttribute("title").split("+")[1]
        if (val.includes("+")){
          val = val.replace(country_code, '').replace(/[^\d]/g, '')
          return {
            "number":val,
            "country_code":country_code
          }
        } else {
          write_error(section, "Must start with country code: +1 123 456 78")
          return null
        }
    }


    const payload = {
      "patient_phone_country_code" : "+92",
      "patient_phone_no" : "3087844475",
      "name" : "ali",
      "phone" : "3087844475",
      "purpose" : "none",
      "type_of_access" : "new",
      "latitude" : "1.12365",
      "longitude" : "2.3654",
      "location" : "nullable",
      "permission_granted_by" : "nullable",
      "permission_granted_role" : "nullable"
    }

    const handleForm = (e) => {
    e.preventDefault();
    const name = document.getElementById("name").value;
    const purpose = document.getElementById("purpose").value;
    const phone_data = check_n_parse_phone('phone-section');
    const client_phone_data = check_n_parse_phone('client-phone-section');
    const loader = document.querySelector("#loader")
    const response_success = document.querySelector("#response_success")
    const response_error = document.querySelector("#response_error")
    // removin previous error responses
   
    loader.classList.toggle('d-none')

    const handleResponse = (data) => {
      response_error.textContent = ''
      response_success.textContent = ''
      if(data.status){
        response_success.textContent = data.message
      } else {
        response_error.textContent = data.message
      }
    }

    // Function to get the user's current location
    const getLocation = () => {
        return new Promise((resolve, reject) => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const latitude = position.coords.latitude;
                        const longitude = position.coords.longitude;
                        resolve({ latitude, longitude });
                    },
                    (error) => {
                       
                        reject("Error: " + error.message);
                    }
                );
            } else {
                reject("Geolocation is not supported by this browser.");
            }
        });
    };

    // Call the function to get the user's current location
    getLocation()
        .then((coordinates) => {
            const formData = {
                "name": name,
                "phone": phone_data.number,
                "patient_phone_no": client_phone_data.number,
                "patient_phone_country_code": client_phone_data.country_code,
                "purpose": purpose,
                "type_of_access": "new",
                "latitude": coordinates.latitude,
                "longitude": coordinates.longitude,
                "location": "nullable",
                "permission_granted_by": "nullable",
                "permission_granted_role": "nullable"
            };
            // Sending the GET request
            fetch('https://portal.medlegalsafekeep.com/api/get_patient_info', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();

            })
            .then(data => {
                console.log('Response from server:', data);
                loader.classList.toggle('d-none')
                handleResponse(data)
            })
            .catch(error => {
                console.error('Error:', error);
                loader.classList.toggle('d-none')

                // Handle errors here, such as displaying a message to the user
            });
        })
        .catch((error) => {
            console.error(error);
            loader.classList.toggle('d-none')

            // Handle error here, such as displaying a message to the user
        });
};



  const requestForm = document.getElementById("request-form");
  console.log(requestForm);
  requestForm.addEventListener('submit', handleForm);

</script>
</html>